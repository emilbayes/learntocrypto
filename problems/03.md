# 03. Withdrawing schmeckels

Not much fun depositing schmeckels with your bank if you can't retrieve them
again! The next task is simply extending the bank, teller and transaction log
with a `withdraw` command.

<details>
  <summary>Solution to problem 02</summary>

```js
// bank.js

var jsonStream = require('duplex-json-stream')
var net = require('net')

var log = [

  ]



function sum() {
    return log.reduce(
        function (accu, x) {
            switch (x.cmd) {
                case 'deposit':
                    return accu + x.amount

                case 'withdraw':
                    return accu - x.amount
                default:
                    return accu
            }
        }
        , 0)
}

var server = net.createServer(function (socket) {
    socket = jsonStream(socket)
    socket.on('data', function (msg) {
        console.log('Bank received:', msg)
        let amount = Math.abs(parseInt(msg.amount))
        switch (msg.cmd){
            case 'balance':
                socket.write({ cmd: 'balance', balance: sum() })
                break
            case 'deposit':
                log.push({cmd: 'deposit', amount: amount})
                socket.write({ cmd: 'balance', balance: sum() })
                break
            case 'withdraw':
                if(amount<=sum()){
                    log.push({cmd: 'withdraw', amount: amount})
                    socket.write({ cmd: 'balance', balance: sum() })

                } else {
                    socket.write("insufficient funds")
                }
                break
            default:
                break
        }
        
    })
})

server.listen(3876)

console.log("started bank")

```

```js
// teller.js
var jsonStream = require('duplex-json-stream')
var net = require('net')

var client = jsonStream(net.connect(3876))

client.on('data', function (msg) {
  console.log('Teller received:', msg)
})

const args = process.argv.slice(2)
const command = args[0]
const amount = Math.abs(parseInt(args[1]))

switch (command){
    case 'balance':
        client.end({cmd: 'balance'})
        break
    case 'deposit':
        client.end({cmd: 'deposit', amount: amount})
        break
    case 'withdraw':
        client.end({cmd: 'withdraw', amount: amount})
        break
    default:
        break
}

console.log("started teller")

```

</details>

## Problem

Add a `withdraw` command, that `.push`es this new entry to the transaction log
and handle the command type when calculating your balance. Remember to check for
sufficient funds (unless your government does bailouts). Also add a new command
to your teller client.

## Testing

Restart your `bank.js` and try making a couple of deposits and withdrawals. You
should try and withdraw more money than is available in the bank, and have your
command be refused.

[Continue to problem 04](04.md)
